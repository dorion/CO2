<?php
/**
 * Implementation of hook_boot()
 */
function co2_boot() {
  require_once('CO2.conf.php');
}

/**
 * Implementation of hook_menu()
 */
function co2_menu() {
  $items = array();

  $items['CO2'] = array(
    'title'            => 'CO2 emission',
    'description'      => 'CO2 emission display data.',
    'page callback'    => 'co2_yearly',
    'access arguments' => array('CO2 show'),
  );

  $items['CO2/yearly'] = array(
    'title'            => 'Yearly CO2 emission save',
    'type'             => MENU_DEFAULT_LOCAL_TASK,
    'access arguments' => array('CO2 show'),
    'weight'           => -20,
  );

  $items['CO2/montly'] = array(
    'title'            => 'Montly CO2 emission save',
    'type'             => MENU_LOCAL_TASK,
    'page callback'    => 'co2_montly',
    'access arguments' => array('CO2 show'),
    'weight'           => -10,
  );

  return $items;
}

/**
 * Implementation of hook_perm()
 */
function co2_perm() {
  return array('CO2 show');
}

/**
 * CO2 emission save yearly view
 *
 * @return string
 *  Return the yearly CO emission save in table format
 */
function co2_yearly() {
  $output = drupal_get_form('co2_year_view_form');

  include('conf_participant_croner.php');
  var_dump(selector());
  return $output;
}

/**
 * CO2 emission save monthly view
 *
 * @return string
 *  Return the monthly CO emission save in table format
 */
function co2_montly() {
  $output = drupal_get_form('co2_month_view_form');

  return $output;
}


/**
 * Validation of the CO2 emission year view
 */
function co2_year_view_form($form_state) {
  $form = array();

  $form['year'] = array(
    '#type'     => 'select',
    '#title'    => t('Year'),
    '#options'  => avaiable_years(),
    '#weight'   => -20,
  );

  $form['submit'] = array(
    '#type'     => 'submit',
    '#value'    => t('Process'),
    '#weight'   => 0,
  );

  return $form;
}

/**
 * Validation of the CO2 emission year view
 */
function co2_year_view_form_validate($form, $form_state) {}

/**
 * Submit of the CO2 emission year view
 */
function co2_year_view_form_submit($form, $form_state) {

}

/**
 * Month iew of the CO2 emission data
 *
 */
function co2_month_view_form($form_state) {
  $form = co2_year_view_form(NULL);

  $form['month'] = array(
            '#type'     => 'select',
            '#title'    => t('Month'),
            '#options'  => array('01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12'),
            '#weight'   => -10,
          );

  return $form;
}

/**
 * Validation of the CO2 emission month view
 */
function co2_month_view_form_validate($form, $form_state) {}

/**
 * Submit of the CO2 emission month view
 */
function co2_month_view_form_submit($form, $form_state) {

}

/**
 * Give back avaiable years
 *
 * @return array
 *  Avaiable years in array format.
 */
function avaiable_years() {
  $years = array();

  return $years;
}

/**
 * Emission save computing
 *
 */
function emission_computing($party_dist, $conf_time) {
  $save = 0;

  $vehicle_co2 = vehicle_co2($party_dist);
  $vidconf_env_co2 = vidconf_env_co2();
  $save = ($party_dist * $vehicle_co2) - ($conf_time * $vidconf_env_co2);

  return $save;
}

function vehicle_co2($distance) {
  if ($distance > 0 AND $distance <= DISTANCE_CAR) {
    return CO2_EMISSION_CAR;
  }
  elseif ($distance > DISTANCE_CAR AND $distance <= DISTANCE_TRAIN) {
    return CO2_EMISSION_TRAIN;
  }
  else {
    return CO2_EMISSION_AEROPLANE;
  }
}

function vidconf_env_co2() {
  return CO2_EMISSION_MCU + CO2_EMISSION_VIDCONF_ENDPOINT;
}
